{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}Change Password{% endblock %}

{% block content %}
<div class="container">
    <h2>Change Password</h2>
    
    <form method="POST">
        {% csrf_token %}

        <!-- Remove {{ form.as_p }} to avoid duplication -->
        
        <div class="mb-3">
            <label for="old_password" class="form-label">Old Password</label>
            <div class="input-group">
                <input type="password" class="form-control" id="old_password" name="old_password" required>
                <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('old_password', 'old_toggle_icon')">
                    <img id="old_toggle_icon" src="https://img.icons8.com/ios-filled/50/000000/invisible.png" alt="Toggle visibility">
                </button>
            </div>
        </div>

        <div class="mb-3">
            <label for="new_password1" class="form-label">New Password</label>
            <div class="input-group">
                <input type="password" class="form-control" id="new_password1" name="new_password1" required>
                <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('new_password1', 'new_toggle_icon')">
                    <img id="new_toggle_icon" src="https://img.icons8.com/ios-filled/50/000000/invisible.png" alt="Toggle visibility">
                </button>
            </div>
        </div>

        <div class="mb-3">
            <label for="new_password2" class="form-label">Confirm New Password</label>
            <div class="input-group">
                <input type="password" class="form-control" id="new_password2" name="new_password2" required>
                <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('new_password2', 'confirm_toggle_icon')">
                    <img id="confirm_toggle_icon" src="https://img.icons8.com/ios-filled/50/000000/invisible.png" alt="Toggle visibility">
                </button>
            </div>
            <input type="hidden" name="user_id" value="{{ user_id }}">
        </div>

        <button type="submit" class="btn btn-primary">Change Password</button>
    </form>

    <a href="{% url 'dashboard' %}" class="btn btn-secondary">Back to Dashboard</a>
</div>

<script>
    function togglePassword(inputId, iconId) {
        let passwordField = document.getElementById(inputId);
        let toggleIcon = document.getElementById(iconId);
        if (passwordField.type === "password") {
            passwordField.type = "text";
            toggleIcon.src = "https://img.icons8.com/ios-filled/50/000000/visible.png";
        } else {
            passwordField.type = "password";
            toggleIcon.src = "https://img.icons8.com/ios-filled/50/000000/invisible.png";
        }
    }
</script>
{% endblock %}
